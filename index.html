<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAIKO PRO | Final Edition ğŸš€</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { --primary: #ff006e; --secondary: #8338ec; --whatsapp: #25d366; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { margin: 0; min-height: 100vh; color: white; transition: background 2s ease; overflow-x: hidden; background: #000; }
        
        canvas { position: fixed; top: 0; left: 0; z-index: 2; pointer-events: none; }
        #lightning { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; z-index: 1; pointer-events: none; }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; position: relative; z-index: 10; }

        /* Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù€ 11 */
        .bg-0 { background: linear-gradient(to bottom, #200122, #6f0000); }
        .bg-1 { background: linear-gradient(to bottom, #0f0c29, #302b63); }
        .bg-2 { background: linear-gradient(to bottom, #4e085e, #ff006e); }
        .bg-3 { background: #000; }
        .bg-4 { background: linear-gradient(to bottom, #000428, #004e92); }
        .bg-5 { background: linear-gradient(to bottom, #1d2671, #c33764); }
        .bg-6 { background: linear-gradient(to bottom, #0f2027, #2c5364); }
        .bg-7 { background: linear-gradient(to right, #11998e, #38ef7d); }
        .bg-8 { background: linear-gradient(to bottom, #8e2de2, #4a00e0); }
        .bg-9 { background: linear-gradient(to bottom, #f12711, #f5af19); }
        .bg-10 { background: #11111d; }

        .card { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(20px); padding: 25px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; text-align: center; position: relative; }
        
        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…Ø·ÙˆØ± */
        .profile-container { position: relative; width: 110px; height: 110px; margin: 0 auto 15px; }
        .profile-img { width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--primary); background: #222; display: flex; align-items: center; justify-content: center; font-size: 3rem; overflow: hidden; object-fit: cover; }
        .edit-pic-label { position: absolute; bottom: 5px; right: 5px; background: var(--primary); border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        #fileInput { display: none; }

        .stats-row { display: flex; justify-content: center; gap: 15px; margin: 15px 0; }
        .stat-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 15px; flex: 1; border: 1px solid rgba(255,255,255,0.1); }
        .stat-num { display: block; font-size: 1.4rem; font-weight: 900; color: var(--primary); }

        .pass-wrapper { position: relative; width: 100%; }
        .toggle-pass { position: absolute; left: 15px; top: 40%; transform: translateY(-50%); cursor: pointer; color: #888; z-index: 5; }
        input, textarea { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 15px; border: 1px solid #444; background: rgba(0,0,0,0.6); color: white; text-align: center; outline: none; }

        .btn { width: 100%; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white; font-weight: bold; cursor: pointer; margin-bottom: 5px; text-decoration: none; display: block; }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        #customModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center; }
        .modal-content { background: #111; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; border: 1px solid var(--primary); text-align: center; }

        #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; }
        .toast { background: white; color: #000; padding: 12px 25px; border-radius: 50px; font-weight: bold; margin-top: 10px; animation: fadeInUp 0.5s ease; border-bottom: 3px solid var(--primary); font-size: 0.8rem; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .message-card { background: rgba(255,255,255,0.08); padding: 18px; border-radius: 20px; margin-bottom: 15px; border-right: 5px solid var(--primary); text-align: right; }
    </style>
</head>
<body class="bg-0">

<div id="toast-container"></div>
<div id="lightning"></div>
<canvas id="effectCanvas"></canvas>

<div id="customModal">
    <div class="modal-content">
        <h3 style="margin-bottom: 20px; color: var(--primary);">ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ğŸ”</h3>
        <input type="password" id="newPassInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
        <button class="btn" onclick="confirmChangePass()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn" style="background:none; color:gray;" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div class="container">
    <div id="authPage" class="card">
        <h1 style="color: var(--primary); font-size: 2.2rem; margin-bottom: 15px;">SAIKO PRO</h1>
        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <div class="pass-wrapper">
            <span class="toggle-pass" onclick="togglePassword()">ğŸ‘ï¸</span>
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        </div>
        <input type="text" id="username" placeholder="Ø§Ù„ÙŠÙˆØ²Ø±Ù†Ø§Ù…">
        <button class="btn" onclick="authAction('login')">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" style="background:none; border:1px solid #555;" onclick="authAction('register')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    </div>

    <div id="mainPage" style="display: none;">
        <div class="card">
            <div class="profile-container">
                <img id="userImg" class="profile-img" src="" alt="ğŸ‘¤">
                <label for="fileInput" id="editPicBtn" class="edit-pic-label" style="display:none;">
                    âœ
                    <input type="file" id="fileInput" accept="image/*" onchange="uploadPhoto(this)">
                </label>
            </div>
            <h2 id="helloUser">@username</h2>
            
            <div class="stats-row">
                <div class="stat-box"><span class="stat-num" id="likesCount">0</span>Ù„Ø§ÙŠÙƒ</div>
                <div class="stat-box"><span class="stat-num" id="followsCount">0</span>Ù…ØªØ§Ø¨Ø¹</div>
            </div>

            <div id="visitorActions" style="display: none;">
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <button class="btn" onclick="addStat('likes')" style="background:#ff4757;">â¤ï¸ Ù„Ø§ÙŠÙƒ</button>
                    <button class="btn" onclick="addStat('followers')" style="background:#3a86ff;">ğŸ‘¤ Ù…ØªØ§Ø¨Ø¹Ø©</button>
                </div>
                <textarea id="msgInput" placeholder="Ø§ÙƒØªØ¨ ØµØ±Ø§Ø­ØªÙƒ..."></textarea>
                <button class="btn" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
            </div>

            <div id="ownerActions">
                <button class="btn" onclick="copyLink()">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ”—</button>
                <a href="https://whatsapp.com/channel/0029VauVHXtEwEk3p5hgcd3j" target="_blank" class="btn" style="background:var(--whatsapp);">ğŸ“¢ Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙˆØ§ØµÙ„</a>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                    <button class="btn" style="background:#333;" onclick="openModal()">ğŸ” Ø§Ù„Ø³Ø±</button>
                    <button class="btn" style="background:red;" onclick="deleteAccount()">ğŸ—‘ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                </div>
                <button onclick="logout()" style="color:gray; background:none; border:none; margin-top:15px; cursor:pointer;">Ø®Ø±ÙˆØ¬ ğŸšª</button>
            </div>
        </div>

        <div id="myMessagesSection">
            <h3 style="text-align: right; margin-bottom:15px;">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ğŸ“¥</h3>
            <div id="messagesContainer"></div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDhz9GpeZE5N78OquK61dQ_pkqTGKbZegc",
        authDomain: "saiko-a6971.firebaseapp.com",
        projectId: "saiko-a6971",
        storageBucket: "saiko-a6971.firebasestorage.app",
        messagingSenderId: "946021136402",
        appId: "1:946021136402:web:3f58bccc68de0663c940cb"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(), db = firebase.firestore();

    function showMsg(t) {
        const c = document.getElementById('toast-container');
        const s = document.createElement('div'); s.className = 'toast'; s.innerText = t;
        c.appendChild(s); setTimeout(() => s.remove(), 3000);
    }

    // --- ÙˆØ¸ÙŠÙØ© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ ---
    function uploadPhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64Img = e.target.result;
                const u = localStorage.getItem('saiko_username');
                try {
                    showMsg("Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©...");
                    await db.collection('users').doc(u).update({ photoURL: base64Img });
                    document.getElementById('userImg').src = base64Img;
                    showMsg("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! âœ…");
                } catch(err) { showMsg("Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹!"); }
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function togglePassword() {
        const p = document.getElementById('password');
        p.type = p.type === 'password' ? 'text' : 'password';
    }

    function openModal() { document.getElementById('customModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('customModal').style.display = 'none'; }

    async function confirmChangePass() {
        const newPass = document.getElementById('newPassInput').value;
        if(newPass.length >= 6) {
            try {
                await auth.currentUser.updatePassword(newPass);
                showMsg("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«! âœ…"); closeModal();
            } catch(e) { showMsg("Ø£Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø±"); }
        } else { showMsg("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¶Ø¹ÙŠÙØ©!"); }
    }

    async function addStat(field) {
        const to = new URLSearchParams(window.location.search).get('to');
        if(to) {
            await db.collection('users').doc(to).update({ [field]: firebase.firestore.FieldValue.increment(1) });
            showMsg("Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙØ§Ø¹Ù„Ùƒ! â¤ï¸");
        }
    }

    async function authAction(type) {
        const e = document.getElementById('email').value, p = document.getElementById('password').value, u = document.getElementById('username').value.toLowerCase().trim();
        try {
            if (type === 'register') {
                const res = await auth.createUserWithEmailAndPassword(e, p);
                await db.collection('users').doc(u).set({ email: e, uid: res.user.uid, photoURL: '', likes: 0, followers: 0 });
                localStorage.setItem('saiko_username', u);
            } else {
                await auth.signInWithEmailAndPassword(e, p);
                const snap = await db.collection('users').where('email', '==', e).get();
                snap.forEach(doc => localStorage.setItem('saiko_username', doc.id));
            }
            location.reload();
        } catch (err) { showMsg(err.message); }
    }

    function loadContent(user, isOwner) {
        db.collection('users').doc(user).onSnapshot(doc => {
            if(doc.exists) {
                const d = doc.data();
                document.getElementById('likesCount').innerText = d.likes || 0;
                document.getElementById('followsCount').innerText = d.followers || 0;
                if(d.photoURL) document.getElementById('userImg').src = d.photoURL;
            }
        });

        if(isOwner) {
            document.getElementById('editPicBtn').style.display = 'flex';
            db.collection('messages').where('to', '==', user).orderBy('time', 'desc').onSnapshot(snap => {
                const container = document.getElementById('messagesContainer');
                container.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    const div = document.createElement('div');
                    div.className = 'message-card'; div.id = 'msg-'+doc.id;
                    div.innerHTML = `
                        <div style="display:flex; justify-content:space-around; font-size:0.7rem; color:#777; margin-bottom:10px; border-bottom:1px solid #333; padding-bottom:5px;">
                            <span onclick="showMsg('â¤ï¸')">â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨</span>
                            <span onclick="showMsg('â­')">â­ Ù…ÙØ¶Ù„Ø©</span>
                            <span>ğŸ‘ï¸ ${Math.floor(Math.random()*30)}</span>
                        </div>
                        <p>${d.text}</p>
                        <div style="margin-top:10px; display:flex; gap:10px;">
                            <button class="btn" style="font-size:0.7rem; padding:5px;" onclick="saveImg('msg-${doc.id}')">ğŸ“¸ ØªØµÙˆÙŠØ±</button>
                            <button class="btn" style="background:red; font-size:0.7rem; padding:5px;" onclick="deleteMsg('${doc.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>`;
                    container.appendChild(div);
                });
            });
        }
    }

    function saveImg(id) {
        html2canvas(document.getElementById(id), {backgroundColor:'#111', scale: 2}).then(c => {
            const a=document.createElement('a'); a.download='saiko.png'; a.href=c.toDataURL(); a.click();
        });
    }

    async function sendMsg() {
        const to = new URLSearchParams(window.location.search).get('to');
        const txt = document.getElementById('msgInput').value;
        if(txt) {
            await db.collection('messages').add({ to: to, text: txt, time: Date.now() });
            showMsg("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! âœ…"); document.getElementById('msgInput').value = '';
        }
    }

    async function deleteAccount() { if(confirm("Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) { await auth.currentUser.delete(); logout(); } }
    async function deleteMsg(id) { if(confirm("Ø­Ø°ÙØŸ")) await db.collection('messages').doc(id).delete(); }
    function logout() { auth.signOut(); localStorage.clear(); location.reload(); }
    function copyLink() {
        const u = localStorage.getItem('saiko_username');
        const link = window.location.origin + window.location.pathname + "?to=" + u;
        navigator.clipboard.writeText(link); showMsg("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø·Ùƒ! ğŸ”—");
    }

    auth.onAuthStateChanged(user => {
        const to = new URLSearchParams(window.location.search).get('to');
        if (to) {
            document.getElementById('authPage').style.display='none'; document.getElementById('mainPage').style.display='block';
            document.getElementById('visitorActions').style.display='block'; document.getElementById('ownerActions').style.display='none';
            document.getElementById('helloUser').innerText = "Ù„Ù€ @" + to; loadContent(to, false);
        } else if (user) {
            document.getElementById('authPage').style.display='none'; document.getElementById('mainPage').style.display='block';
            const myU = localStorage.getItem('saiko_username');
            document.getElementById('helloUser').innerText = "@" + myU; loadContent(myU, true);
        }
    });

    // Ù…Ø­Ø±Ùƒ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª
    let bgIndex = 0;
    setInterval(() => {
        bgIndex = (bgIndex + 1) % 11;
        document.body.className = 'bg-' + bgIndex;
    }, 12000);
</script>
</body>
</html>
